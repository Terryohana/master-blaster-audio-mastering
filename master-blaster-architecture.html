<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Master Blaster Audio Mastering App - Architecture</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --secondary: #10b981;
      --dark: #1e293b;
      --light: #f8fafc;
      --gray: #64748b;
      --gray-light: #e2e8f0;
      --danger: #ef4444;
      --warning: #f59e0b;
    }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: var(--light);
      color: var(--dark);
    }
    
    h1, h2, h3, h4 {
      color: var(--primary-dark);
      margin-top: 1.5em;
      margin-bottom: 0.5em;
    }
    
    h1 {
      font-size: 2.5rem;
      border-bottom: 3px solid var(--primary);
      padding-bottom: 10px;
    }
    
    h2 {
      font-size: 1.8rem;
      border-bottom: 2px solid var(--gray-light);
      padding-bottom: 5px;
    }
    
    h3 {
      font-size: 1.4rem;
    }
    
    pre {
      background-color: var(--dark);
      color: var(--light);
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 0.9rem;
    }
    
    code {
      font-family: 'Courier New', Courier, monospace;
      background-color: var(--gray-light);
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 0.9em;
    }
    
    pre code {
      background-color: transparent;
      padding: 0;
    }
    
    .architecture-diagram {
      width: 100%;
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .component {
      border: 2px solid var(--primary);
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      background-color: white;
    }
    
    .component h3 {
      margin-top: 0;
      border-bottom: 1px solid var(--gray-light);
      padding-bottom: 8px;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--gray-light);
      margin-bottom: 20px;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      border-radius: 5px 5px 0 0;
      margin-right: 5px;
    }
    
    .tab.active {
      background-color: white;
      border-color: var(--gray-light);
      color: var(--primary);
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .note {
      background-color: #e6f7ff;
      border-left: 4px solid var(--primary);
      padding: 10px 15px;
      margin: 15px 0;
    }
    
    .warning {
      background-color: #fff7e6;
      border-left: 4px solid var(--warning);
      padding: 10px 15px;
      margin: 15px 0;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .flow-diagram {
      text-align: center;
      margin: 30px 0;
    }
    
    .flow-step {
      display: inline-block;
      padding: 10px 20px;
      background-color: var(--primary);
      color: white;
      border-radius: 5px;
      margin: 0 10px;
      position: relative;
    }
    
    .flow-step:not(:last-child):after {
      content: "→";
      position: absolute;
      right: -15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 1.2rem;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    
    th, td {
      padding: 10px;
      border: 1px solid var(--gray-light);
      text-align: left;
    }
    
    th {
      background-color: var(--primary);
      color: white;
    }
    
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      margin: 10px 0;
    }
    
    .btn:hover {
      background-color: var(--primary-dark);
    }
    
    .toc {
      background-color: white;
      border: 1px solid var(--gray-light);
      border-radius: 5px;
      padding: 15px;
      margin: 20px 0;
    }
    
    .toc ul {
      list-style-type: none;
      padding-left: 15px;
    }
    
    .toc li {
      margin: 5px 0;
    }
    
    .toc a {
      color: var(--primary);
      text-decoration: none;
    }
    
    .toc a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Master Blaster Audio Mastering App - Architecture</h1>
  
  <div class="toc">
    <h3>Table of Contents</h3>
    <ul>
      <li><a href="#overview">1. System Overview</a></li>
      <li><a href="#tech-stack">2. Technology Stack</a></li>
      <li><a href="#architecture">3. Application Architecture</a>
        <ul>
          <li><a href="#frontend">3.1 Frontend Architecture</a></li>
          <li><a href="#backend">3.2 Backend Architecture</a></li>
          <li><a href="#data-model">3.3 Data Model</a></li>
        </ul>
      </li>
      <li><a href="#auth">4. Authentication & Authorization</a></li>
      <li><a href="#audio-processing">5. Audio Processing Architecture</a></li>
      <li><a href="#deployment">6. Deployment Architecture</a></li>
      <li><a href="#scaling">7. Scaling Considerations</a></li>
      <li><a href="#security">8. Security Considerations</a></li>
      <li><a href="#implementation">9. Implementation Guide</a></li>
    </ul>
  </div>

  <section id="overview">
    <h2>1. System Overview</h2>
    <p>Master Blaster is a professional audio mastering application that allows users to process audio tracks with high-quality EQ, compression, and other audio effects. The application provides both real-time processing and offline rendering capabilities.</p>
    
    <div class="architecture-diagram">
      <h3>High-Level System Architecture</h3>
      <pre>
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                      Client Application                         │
│                                                                 │
│  ┌───────────────┐   ┌───────────────┐   ┌───────────────┐      │
│  │               │   │               │   │               │      │
│  │  UI Components│   │ Audio Engine  │   │ State Manager │      │
│  │               │   │               │   │               │      │
│  └───────┬───────┘   └───────┬───────┘   └───────┬───────┘      │
│          │                   │                   │              │
└──────────┼───────────────────┼───────────────────┼──────────────┘
           │                   │                   │
           ▼                   ▼                   ▼
┌──────────────────────────────────────────────────────────────────┐
│                                                                  │
│                        Convex Backend                            │
│                                                                  │
│  ┌───────────────┐   ┌───────────────┐   ┌───────────────┐       │
│  │               │   │               │   │               │       │
│  │  Auth Service │   │  Data Store   │   │ File Storage  │       │
│  │   (Clerk)     │   │               │   │               │       │
│  └───────────────┘   └───────────────┘   └───────────────┘       │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
      </pre>
    </div>
    
    <p>The system consists of:</p>
    <ul>
      <li><strong>Client Application</strong>: React-based frontend with Web Audio API integration</li>
      <li><strong>Backend Services</strong>: Convex for data storage, authentication, and file handling</li>
      <li><strong>Authentication</strong>: Clerk for secure user management</li>
      <li><strong>Storage</strong>: Audio file storage and project data persistence</li>
    </ul>
  </section>

  <section id="tech-stack">
    <h2>2. Technology Stack</h2>
    
    <div class="grid">
      <div class="component">
        <h3>Frontend</h3>
        <ul>
          <li><strong>Framework</strong>: React 19</li>
          <li><strong>Build Tool</strong>: Vite</li>
          <li><strong>Styling</strong>: Tailwind CSS</li>
          <li><strong>Audio Processing</strong>: Web Audio API</li>
          <li><strong>State Management</strong>: React Hooks + Context</li>
          <li><strong>UI Components</strong>: Custom components</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Backend</h3>
        <ul>
          <li><strong>Platform</strong>: Convex</li>
          <li><strong>Language</strong>: TypeScript</li>
          <li><strong>Database</strong>: Convex Document Store</li>
          <li><strong>File Storage</strong>: Convex Storage</li>
          <li><strong>Authentication</strong>: Clerk</li>
          <li><strong>API</strong>: Convex Functions (queries, mutations, actions)</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>DevOps</h3>
        <ul>
          <li><strong>Hosting</strong>: Netlify (Frontend)</li>
          <li><strong>CI/CD</strong>: GitHub + Netlify Integration</li>
          <li><strong>Version Control</strong>: Git/GitHub</li>
          <li><strong>Environment</strong>: Development, Production</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="architecture">
    <h2>3. Application Architecture</h2>
    <p>Master Blaster follows a modern web application architecture with a clear separation between frontend and backend components.</p>
    
    <section id="frontend">
      <h3>3.1 Frontend Architecture</h3>
      <p>The frontend is built with React and follows a component-based architecture. Key aspects include:</p>
      
      <div class="architecture-diagram">
        <h4>Frontend Component Structure</h4>
        <pre>
┌─────────────────────────────────────────────────────────────┐
│                      App Component                          │
└───────────────────────────┬─────────────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            │               │               │
┌───────────▼──────┐ ┌─────▼─────┐ ┌───────▼───────┐
│  Authentication  │ │  Router   │ │ State Context │
└───────────┬──────┘ └─────┬─────┘ └───────┬───────┘
            │              │               │
            └──────────────┼───────────────┘
                           │
         ┌────────────────┬┴┬────────────────┐
         │                │ │                │
┌────────▼───────┐ ┌─────▼─▼─────┐ ┌────────▼───────┐
│  Landing Page  │ │ Audio Editor │ │ Project Manager │
└────────────────┘ └─────────────┘ └────────────────┘
                          │
         ┌────────────────┴────────────────┐
         │                                 │
┌────────▼───────┐                ┌────────▼───────┐
│  Audio Engine  │                │    UI Controls  │
└────────────────┘                └────────────────┘
        </pre>
      </div>
      
      <p>Key frontend components:</p>
      <ul>
        <li><strong>Audio Engine</strong>: Handles real-time audio processing using Web Audio API</li>
        <li><strong>UI Controls</strong>: EQ sliders, compressor knobs, and transport controls</li>
        <li><strong>State Management</strong>: React Context for global state management</li>
        <li><strong>Authentication</strong>: Integration with Clerk for user authentication</li>
        <li><strong>Project Management</strong>: Interface for creating, loading, and saving projects</li>
      </ul>
    </section>
    
    <section id="backend">
      <h3>3.2 Backend Architecture</h3>
      <p>The backend is built on Convex, a backend-as-a-service platform that provides database, storage, and serverless functions.</p>
      
      <div class="architecture-diagram">
        <h4>Backend Service Structure</h4>
        <pre>
┌─────────────────────────────────────────────────────────────┐
│                     Convex Backend                          │
└───────────────────────────┬─────────────────────────────────┘
                            │
    ┌─────────────┬─────────┴─────────┬─────────────┐
    │             │                   │             │
┌───▼───┐   ┌─────▼─────┐       ┌─────▼─────┐ ┌─────▼─────┐
│Queries│   │ Mutations │       │  Actions  │ │   HTTP    │
└───┬───┘   └─────┬─────┘       └─────┬─────┘ └─────┬─────┘
    │             │                   │             │
    └─────────────┴─────────┬─────────┴─────────────┘
                            │
                     ┌──────▼──────┐
                     │   Database  │
                     └──────┬──────┘
                            │
                     ┌──────▼──────┐
                     │   Storage   │
                     └─────────────┘
        </pre>
      </div>
      
      <p>Key backend components:</p>
      <ul>
        <li><strong>Queries</strong>: Read-only functions for fetching data</li>
        <li><strong>Mutations</strong>: Functions that modify data</li>
        <li><strong>Actions</strong>: Functions that interact with external services</li>
        <li><strong>HTTP Endpoints</strong>: REST API endpoints for external integrations</li>
        <li><strong>Database</strong>: Document store for structured data</li>
        <li><strong>Storage</strong>: Binary storage for audio files</li>
      </ul>
    </section>
    
    <section id="data-model">
      <h3>3.3 Data Model</h3>
      <p>The application uses the following data models:</p>
      
      <div class="architecture-diagram">
        <h4>Database Schema</h4>
        <pre>
┌─────────────────┐       ┌─────────────────┐
│      users      │       │   userProfiles  │
├─────────────────┤       ├─────────────────┤
│ _id             │       │ _id             │
│ tokenIdentifier │◄──────┤ userId          │
│ email           │       │ role            │
│ name            │       │ subscriptionTier│
│ lastSignIn      │       │ tracksUsed      │
└─────────────────┘       │ storageUsed     │
                          └─────────────────┘
                                   ▲
                                   │
┌─────────────────┐       ┌───────┴───────┐
│   eqPresets     │       │    projects    │
├─────────────────┤       ├─────────────────┤
│ _id             │       │ _id             │
│ name            │       │ userId          │
│ category        │◄──────┤ name            │
│ settings        │       │ eqPreset        │
└─────────────────┘       │ eqSettings      │
                          │ compressorSettings
                          │ originalAudioId │
                          │ masteredAudioId │
                          │ status          │
                          │ createdAt       │
                          │ expiresAt       │
                          └─────────────────┘
        </pre>
      </div>
      
      <p>Key data entities:</p>
      <ul>
        <li><strong>users</strong>: User authentication information</li>
        <li><strong>userProfiles</strong>: User preferences and subscription information</li>
        <li><strong>projects</strong>: Audio projects with processing settings</li>
        <li><strong>eqPresets</strong>: Predefined equalizer settings</li>
      </ul>
    </section>
  </section>

  <section id="auth">
    <h2>4. Authentication & Authorization</h2>
    <p>Master Blaster uses Clerk for authentication, integrated with Convex for authorization.</p>
    
    <div class="architecture-diagram">
      <h3>Authentication Flow</h3>
      <pre>
┌──────────┐     ┌───────┐     ┌───────┐     ┌──────────┐
│  Browser  │────►│ Clerk │────►│ Convex│────►│  Backend │
└──────────┘     └───────┘     └───────┘     └──────────┘
      │             │             │              │
      │  1. Login   │             │              │
      │─────────────►             │              │
      │             │             │              │
      │  2. Token   │             │              │
      │◄─────────────             │              │
      │             │             │              │
      │        3. API Request with Token         │
      │─────────────────────────────────────────►│
      │             │             │              │
      │             │  4. Verify Token           │
      │             │◄────────────┐              │
      │             │             │              │
      │             │  5. Token Valid            │
      │             │─────────────►              │
      │             │             │              │
      │             │         6. Execute Request │
      │             │             │─────────────►│
      │             │             │              │
      │         7. Response Data                 │
      │◄─────────────────────────────────────────│
      </pre>
    </div>
    
    <p>The authentication system includes:</p>
    <ul>
      <li><strong>User Registration/Login</strong>: Handled by Clerk</li>
      <li><strong>Token Management</strong>: JWT tokens for API authentication</li>
      <li><strong>Role-Based Access</strong>: User and Admin roles</li>
      <li><strong>Authorization Checks</strong>: Performed in Convex functions</li>
    </ul>
  </section>

  <section id="audio-processing">
    <h2>5. Audio Processing Architecture</h2>
    <p>The audio processing system uses Web Audio API for real-time processing and offline rendering.</p>
    
    <div class="architecture-diagram">
      <h3>Audio Processing Pipeline</h3>
      <pre>
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│  Audio Input  │───►│    EQ Bands   │───►│   Compressor  │
└───────────────┘    └───────────────┘    └───────────────┘
                                                 │
                                                 ▼
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│   Analyzer    │◄───│  Audio Output │◄───│   Limiter     │
└───────────────┘    └───────────────┘    └───────────────┘
        │
        ▼
┌───────────────┐
│   VU Meters   │
└───────────────┘
      </pre>
    </div>
    
    <p>Key audio processing components:</p>
    <ul>
      <li><strong>7-Band Equalizer</strong>: Parametric EQ with adjustable frequency bands</li>
      <li><strong>Compressor</strong>: Dynamic range compression with threshold, ratio, attack, and release controls</li>
      <li><strong>Limiter</strong>: Peak limiting for preventing clipping</li>
      <li><strong>Analyzer</strong>: Real-time frequency and amplitude analysis</li>
      <li><strong>VU Meters</strong>: Visual feedback for audio levels</li>
    </ul>
  </section>

  <section id="deployment">
    <h2>6. Deployment Architecture</h2>
    <p>Master Blaster is deployed using a combination of Netlify for the frontend and Convex for the backend.</p>
    
    <div class="architecture-diagram">
      <h3>Deployment Architecture</h3>
      <pre>
┌───────────────────────────────────────────────────────────┐
│                      GitHub Repository                    │
└───────────────────────────┬───────────────────────────────┘
                            │
              ┌─────────────┴─────────────┐
              │                           │
    ┌─────────▼────────┐        ┌─────────▼────────┐
    │  Netlify Build   │        │   Convex Deploy  │
    └─────────┬────────┘        └─────────┬────────┘
              │                           │
    ┌─────────▼────────┐        ┌─────────▼────────┐
    │ Netlify Hosting  │        │  Convex Backend  │
    └─────────┬────────┘        └─────────┬────────┘
              │                           │
              └───────────┬───────────────┘
                          │
                ┌─────────▼─────────┐
                │  Production App   │
                └───────────────────┘
      </pre>
    </div>
    
    <p>Deployment process:</p>
    <ul>
      <li><strong>Code Push</strong>: Changes are pushed to GitHub</li>
      <li><strong>Frontend Build</strong>: Netlify automatically builds and deploys the frontend</li>
      <li><strong>Backend Deploy</strong>: Convex backend is deployed separately</li>
      <li><strong>Environment Variables</strong>: Configured in Netlify for frontend and Convex for backend</li>
      <li><strong>Domain Configuration</strong>: Custom domain setup in Netlify</li>
    </ul>
  </section>

  <section id="scaling">
    <h2>7. Scaling Considerations</h2>
    <p>As the application grows, several scaling considerations need to be addressed:</p>
    
    <div class="grid">
      <div class="component">
        <h3>Frontend Scaling</h3>
        <ul>
          <li><strong>Code Splitting</strong>: Lazy loading components</li>
          <li><strong>Asset Optimization</strong>: Compression and CDN delivery</li>
          <li><strong>Caching</strong>: Browser and CDN caching strategies</li>
          <li><strong>Performance Monitoring</strong>: Real User Monitoring (RUM)</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Backend Scaling</h3>
        <ul>
          <li><strong>Database Indexing</strong>: Optimized queries</li>
          <li><strong>Rate Limiting</strong>: Prevent abuse</li>
          <li><strong>Caching</strong>: Query result caching</li>
          <li><strong>Pagination</strong>: For large data sets</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Storage Scaling</h3>
        <ul>
          <li><strong>File Size Limits</strong>: Restrict maximum file sizes</li>
          <li><strong>Storage Quotas</strong>: Based on subscription tiers</li>
          <li><strong>Cleanup Policies</strong>: For expired or unused files</li>
          <li><strong>Compression</strong>: For audio storage optimization</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="security">
    <h2>8. Security Considerations</h2>
    <p>Security is a critical aspect of the Master Blaster application:</p>
    
    <div class="grid">
      <div class="component">
        <h3>Authentication Security</h3>
        <ul>
          <li><strong>JWT Validation</strong>: Proper token verification</li>
          <li><strong>Session Management</strong>: Secure session handling</li>
          <li><strong>Password Policies</strong>: Enforced by Clerk</li>
          <li><strong>MFA Support</strong>: Multi-factor authentication</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Data Security</h3>
        <ul>
          <li><strong>Data Encryption</strong>: At rest and in transit</li>
          <li><strong>Access Controls</strong>: Proper authorization checks</li>
          <li><strong>Input Validation</strong>: Prevent injection attacks</li>
          <li><strong>Data Isolation</strong>: Multi-tenant security</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Infrastructure Security</h3>
        <ul>
          <li><strong>HTTPS</strong>: Secure communication</li>
          <li><strong>CORS Policies</strong>: Prevent unauthorized access</li>
          <li><strong>Rate Limiting</strong>: Prevent DoS attacks</li>
          <li><strong>Monitoring</strong>: Security event logging</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="implementation">
    <h2>9. Implementation Guide</h2>
    <p>The implementation of Master Blaster follows these key phases:</p>
    
    <div class="flow-diagram">
      <div class="flow-step">Setup</div>
      <div class="flow-step">Core Features</div>
      <div class="flow-step">Audio Processing</div>
      <div class="flow-step">User Management</div>
      <div class="flow-step">Deployment</div>
    </div>
    
    <h3>Implementation Phases</h3>
    <ol>
      <li><strong>Setup Phase</strong>
        <ul>
          <li>Project initialization with Vite</li>
          <li>Convex backend setup</li>
          <li>Authentication integration with Clerk</li>
          <li>Basic UI components and routing</li>
        </ul>
      </li>
      <li><strong>Core Features Phase</strong>
        <ul>
          <li>Audio file upload and management</li>
          <li>Project creation and storage</li>
          <li>Basic audio playback</li>
        </ul>
      </li>
      <li><strong>Audio Processing Phase</strong>
        <ul>
          <li>Web Audio API integration</li>
          <li>EQ implementation</li>
          <li>Compressor implementation</li>
          <li>Real-time processing</li>
          <li>Offline rendering</li>
        </ul>
      </li>
      <li><strong>User Management Phase</strong>
        <ul>
          <li>User profiles</li>
          <li>Subscription management</li>
          <li>Usage tracking</li>
          <li>Admin features</li>
        </ul>
      </li>
      <li><strong>Deployment Phase</strong>
        <ul>
          <li>CI/CD setup</li>
          <li>Environment configuration</li>
          <li>Production deployment</li>
          <li>Monitoring and analytics</li>
        </ul>
      </li>
    </ol>
    
    <div class="note">
      <strong>Note:</strong> This implementation guide provides a high-level overview. Detailed implementation instructions are available in the project documentation.
    </div>
  </section><strong>Platform</strong>: Convex</li>
          <li><strong>Database</strong>: Convex Database (document-based)</li>
          <li><strong>Authentication</strong>: Clerk</li>
          <li><strong>File Storage</strong>: Convex File Storage</li>
          <li><strong>API</strong>: Convex Functions</li>
          <li><strong>Real-time</strong>: Convex Subscriptions</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>DevOps</h3>
        <ul>
          <li><strong>Version Control</strong>: Git</li>
          <li><strong>CI/CD</strong>: GitHub Actions</li>
          <li><strong>Hosting</strong>: Vercel (frontend), Convex (backend)</li>
          <li><strong>Monitoring</strong>: Convex Dashboard</li>
          <li><strong>Testing</strong>: Vitest, React Testing Library</li>
        </ul>
      </div>
    </div>
  </section>

  <section id="architecture">
    <h2>3. Application Architecture</h2>
    
    <section id="frontend">
      <h3>3.1 Frontend Architecture</h3>
      
      <p>The frontend follows a component-based architecture with clear separation of concerns:</p>
      
      <div class="architecture-diagram">
        <pre>
┌─────────────────────────────────────────────────────────────────┐
│                      Frontend Architecture                      │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│                 │  │                 │  │                 │
│  Presentation   │  │  Application    │  │    Domain       │
│     Layer       │  │     Layer       │  │     Layer       │
│                 │  │                 │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  UI Components  │  │  State Mgmt &   │  │  Audio Engine   │
│  Pages & Layout │  │  Business Logic │  │  & Processing   │
└─────────────────┘  └─────────────────┘  └─────────────────┘
        </pre>
      </div>
      
      <h4>Key Components:</h4>
      
      <div class="grid">
        <div class="component">
          <h3>Presentation Layer</h3>
          <ul>
            <li><strong>Pages</strong>: Main application views</li>
            <li><strong>Components</strong>: Reusable UI elements</li>
            <li><strong>Layout</strong>: Structure and navigation</li>
          </ul>
          <p><em>Example components: Dashboard, LiveAudioProcessor, ProjectsPage</em></p>
        </div>
        
        <div class="component">
          <h3>Application Layer</h3>
          <ul>
            <li><strong>Hooks</strong>: Custom React hooks for logic</li>
            <li><strong>Context</strong>: Shared state management</li>
            <li><strong>Services</strong>: API integration</li>
          </ul>
          <p><em>Example: useAudioProcessing, ProjectContext, ConvexService</em></p>
        </div>
        
        <div class="component">
          <h3>Domain Layer</h3>
          <ul>
            <li><strong>Audio Engine</strong>: Web Audio API integration</li>
            <li><strong>Models</strong>: Core business entities</li>
            <li><strong>Utils</strong>: Audio processing utilities</li>
          </ul>
          <p><em>Example: AudioProcessor, EQProcessor, Project model</em></p>
        </div>
      </div>
      
      <h4>Component Structure Example:</h4>
      
      <pre><code>src/
├── components/
│   ├── common/
│   │   ├── Button.tsx
│   │   ├── Slider.tsx
│   │   └── ...
│   ├── audio/
│   │   ├── EQBand.tsx
│   │   ├── Compressor.tsx
│   │   └── ...
│   └── layout/
│       ├── Header.tsx
│       ├── Sidebar.tsx
│       └── ...
├── pages/
│   ├── Dashboard.tsx
│   ├── ProjectsPage.tsx
│   ├── LiveAudioProcessor.tsx
│   └── ...
├── hooks/
│   ├── useAudioContext.ts
│   ├── useEQProcessor.ts
│   └── ...
├── context/
│   ├── AuthContext.tsx
│   ├── ProjectContext.tsx
│   └── ...
├── services/
│   ├── audioEngine.ts
│   ├── fileStorage.ts
│   └── ...
├── utils/
│   ├── audioProcessing.ts
│   ├── formatters.ts
│   └── ...
└── App.tsx</code></pre>
    </section>
    
    <section id="backend">
      <h3>3.2 Backend Architecture</h3>
      
      <p>The backend is built on Convex, which provides a serverless architecture with real-time capabilities:</p>
      
      <div class="architecture-diagram">
        <pre>
┌─────────────────────────────────────────────────────────────────┐
│                      Convex Backend                             │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│                 │  │                 │  │                 │
│  API Functions  │  │  Database       │  │  File Storage   │
│                 │  │                 │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  Mutations      │  │  Document       │  │  Audio Files    │
│  Queries        │  │  Collections    │  │  Storage        │
│  Actions        │  │                 │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
        </pre>
      </div>
      
      <h4>Key Components:</h4>
      
      <div class="grid">
        <div class="component">
          <h3>API Functions</h3>
          <ul>
            <li><strong>Mutations</strong>: Write operations</li>
            <li><strong>Queries</strong>: Read operations</li>
            <li><strong>Actions</strong>: External API calls</li>
          </ul>
          <p><em>Example: createProject, getProject, uploadAudio</em></p>
        </div>
        
        <div class="component">
          <h3>Database</h3>
          <ul>
            <li><strong>Schema</strong>: Data structure definitions</li>
            <li><strong>Collections</strong>: Document collections</li>
            <li><strong>Indexes</strong>: Query optimization</li>
          </ul>
          <p><em>Example: users, projects, eqPresets collections</em></p>
        </div>
        
        <div class="component">
          <h3>File Storage</h3>
          <ul>
            <li><strong>Audio Files</strong>: Original and processed</li>
            <li><strong>Storage API</strong>: Upload/download</li>
            <li><strong>Access Control</strong>: Permissions</li>
          </ul>
          <p><em>Example: Audio file storage and retrieval</em></p>
        </div>
      </div>
      
      <h4>Convex Structure Example:</h4>
      
      <pre><code>convex/
├── schema.ts           # Database schema definition
├── users.ts            # User-related functions
├── projects.ts         # Project management functions
├── eqPresets.ts        # EQ preset functions
├── auth.ts             # Authentication helpers
├── http.ts             # HTTP endpoints
├── storage.ts          # File storage helpers
└── _generated/         # Auto-generated types</code></pre>
    </section>
    
    <section id="data-model">
      <h3>3.3 Data Model</h3>
      
      <p>The application uses a document-based data model with the following key collections:</p>
      
      <div class="component">
        <h3>Core Data Model</h3>
        <pre><code>// User
{
  _id: Id<"users">,
  clerkId: string,
  email: string,
  profile: {
    firstName: string,
    lastName: string,
    avatarUrl?: string
  },
  subscription: {
    tier: "free" | "pro" | "enterprise",
    expiresAt: number,
    features: string[]
  },
  createdAt: number
}

// Project
{
  _id: Id<"projects">,
  userId: Id<"users">,
  name: string,
  description?: string,
  originalAudioUrl: string,
  processedAudioUrl?: string,
  eqPreset: string,
  eqSettings: Array<{
    frequency: number,
    gain: number,
    Q: number
  }>,
  compressorSettings: {
    threshold: number,
    ratio: number,
    attack: number,
    release: number
  },
  status: "uploading" | "queued" | "processing" | "completed" | "failed",
  duration: number,
  fileSize: number,
  _creationTime: number
}

// EQ Preset
{
  _id: Id<"eqPresets">,
  userId: Id<"users">,
  name: string,
  category: string,
  isPublic: boolean,
  settings: number[],
  description?: string,
  _creationTime: number
}</code></pre>
      </div>
      
      <h4>Relationships:</h4>
      <ul>
        <li>A <strong>User</strong> can have multiple <strong>Projects</strong> (one-to-many)</li>
        <li>A <strong>User</strong> can create multiple <strong>EQ Presets</strong> (one-to-many)</li>
        <li>A <strong>Project</strong> references an <strong>EQ Preset</strong> by name (many-to-one)</li>
      </ul>
    </section>
  </section>

  <section id="auth">
    <h2>4. Authentication & Authorization</h2>
    
    <p>The application uses Clerk for authentication, integrated with Convex for authorization:</p>
    
    <div class="architecture-diagram">
      <pre>
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  React Client   │◄────┤  Clerk Auth     │────►│  Convex Backend │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        │                        │                      │
        │                        │                      │
        ▼                        ▼                      ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Auth Context   │     │  Auth Tokens    │     │  Auth Rules     │
│  & Hooks        │     │  & Session      │     │  & Policies     │
└─────────────────┘     └─────────────────┘     └─────────────────┘
      </pre>
    </div>
    
    <div class="grid">
      <div class="component">
        <h3>Authentication Flow</h3>
        <ol>
          <li>User signs in via Clerk (email/password, social, etc.)</li>
          <li>Clerk issues JWT token</li>
          <li>Token is passed to Convex</li>
          <li>Convex validates token and creates session</li>
          <li>User identity is available in all Convex functions</li>
        </ol>
      </div>
      
      <div class="component">
        <h3>Authorization Model</h3>
        <ul>
          <li><strong>Role-Based Access Control</strong>:
            <ul>
              <li>Free users: Limited projects, basic features</li>
              <li>Pro users: More projects, all features</li>
              <li>Admin users: System management</li>
            </ul>
          </li>
          <li><strong>Resource-Based Access Control</strong>:
            <ul>
              <li>Users can only access their own projects</li>
              <li>Public presets are available to all users</li>
              <li>Private presets are user-specific</li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    
    <h4>Implementation Example:</h4>
    
    <div class="tabs">
      <div class="tab active" onclick="showTab('auth-tab-1')">Clerk Setup</div>
      <div class="tab" onclick="showTab('auth-tab-2')">Convex Integration</div>
      <div class="tab" onclick="showTab('auth-tab-3')">Auth Rules</div>
    </div>
    
    <div id="auth-tab-1" class="tab-content active">
      <pre><code>// auth.config.ts
import { createClerkClient } from "@clerk/clerk-sdk-node";
import { convexHttpAction } from "convex/server";

export default convexHttpAction(async (ctx, request) => {
  // Get the user token from the request
  const authHeader = request.headers.get("authorization");
  if (!authHeader) {
    return new Response(JSON.stringify({ error: "Unauthorized" }), {
      status: 401,
    });
  }

  const token = authHeader.replace("Bearer ", "");
  
  // Validate with Clerk
  const clerk = createClerkClient({
    secretKey: process.env.CLERK_SECRET_KEY,
  });
  
  try {
    const session = await clerk.sessions.verifyToken(token);
    return new Response(
      JSON.stringify({
        success: true,
        userId: session.userId,
      })
    );
  } catch (err) {
    return new Response(JSON.stringify({ error: "Invalid token" }), {
      status: 401,
    });
  }
});</code></pre>
    </div>
    
    <div id="auth-tab-2" class="tab-content">
      <pre><code>// auth.ts
import { v } from "convex/values";
import { query, mutation } from "./_generated/server";

// Get the current user
export const getCurrentUser = query({
  args: {},
  handler: async (ctx) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) {
      return null;
    }

    // Get user from database
    const user = await ctx.db
      .query("users")
      .filter((q) => q.eq(q.field("clerkId"), identity.subject))
      .first();
      
    return user;
  },
});

// Create or update user profile
export const createUserProfile = mutation({
  args: {},
  handler: async (ctx) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) {
      throw new Error("Not authenticated");
    }

    // Check if user exists
    const existingUser = await ctx.db
      .query("users")
      .filter((q) => q.eq(q.field("clerkId"), identity.subject))
      .first();
      
    if (existingUser) {
      return existingUser._id;
    }

    // Create new user
    const userId = await ctx.db.insert("users", {
      clerkId: identity.subject,
      email: identity.email,
      profile: {
        firstName: identity.firstName || "",
        lastName: identity.lastName || "",
        avatarUrl: identity.pictureUrl,
      },
      subscription: {
        tier: "free",
        expiresAt: Date.now() + 30 * 24 * 60 * 60 * 1000, // 30 days
        features: ["basic_eq", "basic_compression"],
      },
      createdAt: Date.now(),
    });

    return userId;
  },
});</code></pre>
    </div>
    
    <div id="auth-tab-3" class="tab-content">
      <pre><code>// projects.ts with authorization rules
import { v } from "convex/values";
import { query, mutation } from "./_generated/server";
import { Id } from "./_generated/dataModel";

// Get a project with authorization check
export const getProject = query({
  args: { projectId: v.id("projects") },
  handler: async (ctx, args) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) {
      throw new Error("Not authenticated");
    }

    // Get user
    const user = await ctx.db
      .query("users")
      .filter((q) => q.eq(q.field("clerkId"), identity.subject))
      .first();
      
    if (!user) {
      throw new Error("User not found");
    }

    // Get project
    const project = await ctx.db.get(args.projectId);
    
    // Authorization check: only allow access to own projects
    if (!project || project.userId !== user._id) {
      throw new Error("Project not found or access denied");
    }

    return project;
  },
});</code></pre>
    </div>
  </section>

  <section id="audio-processing">
    <h2>5. Audio Processing Architecture</h2>
    
    <p>The audio processing system is built on the Web Audio API with a dual-mode architecture:</p>
    
    <div class="architecture-diagram">
      <pre>
┌─────────────────────────────────────────────────────────────────┐
│                   Audio Processing Architecture                 │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│                 │  │                 │  │                 │
│  Live Mode      │  │  Offline Mode   │  │  Shared         │
│  Processing     │  │  Processing     │  │  Components     │
│                 │  │                 │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
        │                    │                    │
        ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│  Real-time      │  │  Rendering      │  │  Audio Analysis │
│  Audio Chain    │  │  & Export       │  │  & Visualization│
└─────────────────┘  └─────────────────┘  └─────────────────┘
      </pre>
    </div>
    
    <div class="grid">
      <div class="component">
        <h3>Live Processing Mode</h3>
        <ul>
          <li><strong>Real-time Audio Chain</strong>: Process audio as it plays</li>
          <li><strong>Interactive Controls</strong>: Immediate feedback</li>
          <li><strong>Dual Audio Element</strong>: Seamless switching</li>
          <li><strong>Visualization</strong>: Real-time meters and analysis</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Offline Processing Mode</h3>
        <ul>
          <li><strong>OfflineAudioContext</strong>: High-quality rendering</li>
          <li><strong>WAV Export</strong>: Download processed audio</li>
          <li><strong>Batch Processing</strong>: Apply multiple effects</li>
          <li><strong>Progress Tracking</strong>: Status updates</li>
        </ul>
      </div>
    </div>
    
    <h4>Audio Processing Chain:</h4>
    
    <div class="flow-diagram">
      <div class="flow-step">Audio Source</div>
      <div class="flow-step">Compressor</div>
      <div class="flow-step">EQ Filters</div>
      <div class="flow-step">Analyzer</div>
      <div class="flow-step">Output</div>
    </div>
    
    <h4>Implementation Example:</h4>
    
    <pre><code>// Dual Audio Element Architecture
const initializeEQProcessing = useCallback(async (audioElement) => {
  if (!audioElement || audioContextRef.current) return;
  
  audioContextRef.current = new AudioContext();
  
  if (audioContextRef.current.state === 'suspended') {
    await audioContextRef.current.resume();
  }
  
  sourceRef.current = audioContextRef.current.createMediaElementSource(audioElement);
  
  // Create analyser for meters
  analyserRef.current = audioContextRef.current.createAnalyser();
  analyserRef.current.fftSize = 4096;
  analyserRef.current.smoothingTimeConstant = 0.0;
  
  // Create compressor
  compressorRef.current = audioContextRef.current.createDynamicsCompressor();
  compressorRef.current.threshold.value = compressor.threshold;
  compressorRef.current.ratio.value = compressor.ratio;
  compressorRef.current.attack.value = compressor.attack;
  compressorRef.current.release.value = compressor.release;
  
  // Create filters for each EQ band
  filtersRef.current = eqBands.map((band) => {
    const filter = audioContextRef.current.createBiquadFilter();
    filter.type = 'peaking';
    filter.frequency.value = band.frequency;
    filter.gain.value = band.gain;
    filter.Q.value = band.Q;
    return filter;
  });

  // Connect audio chain: source -> compressor -> EQ filters -> analyser -> destination
  let currentNode = sourceRef.current;
  
  // First connect to compressor
  currentNode.connect(compressorRef.current);
  currentNode = compressorRef.current;
  
  // Then through EQ filters
  filtersRef.current.forEach(filter => {
    currentNode.connect(filter);
    currentNode = filter;
  });
  
  // Connect to analyser for metering
  currentNode.connect(analyserRef.current);
  
  // Finally to destination for audio output
  currentNode.connect(audioContextRef.current.destination);
  
  // Start meter updates
  updateMeters();
  
  return true;
}, [compressor, eqBands, updateMeters]);</code></pre>
  </section>

  <section id="deployment">
    <h2>6. Deployment Architecture</h2>
    
    <p>The application is deployed using a modern cloud-native architecture:</p>
    
    <div class="architecture-diagram">
      <pre>
┌─────────────────────────────────────────────────────────────────┐
│                   Deployment Architecture                       │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│                 │  │                 │  │                 │
│  Frontend       │  │  Backend        │  │  Auth & Storage │
│  (Vercel)       │  │  (Convex)       │  │  (Clerk/Convex) │
│                 │  │                 │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
      </pre>
    </div>
    
    <div class="grid">
      <div class="component">
        <h3>Frontend Deployment (Vercel)</h3>
        <ul>
          <li><strong>Static Assets</strong>: React application</li>
          <li><strong>CDN Distribution</strong>: Global edge network</li>
          <li><strong>CI/CD</strong>: Automatic deployment from GitHub</li>
          <li><strong>Environment</strong>: Production, Preview, Development</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Backend Deployment (Convex)</h3>
        <ul>
          <li><strong>Serverless Functions</strong>: API endpoints</li>
          <li><strong>Database</strong>: Managed document store</li>
          <li><strong>Real-time</strong>: WebSocket connections</li>
          <li><strong>Scaling</strong>: Automatic horizontal scaling</li>
        </ul>
      </div>
    </div>
    
    <h4>Deployment Flow:</h4>
    
    <div class="flow-diagram">
      <div class="flow-step">Code Push</div>
      <div class="flow-step">CI/CD Pipeline</div>
      <div class="flow-step">Build & Test</div>
      <div class="flow-step">Deploy</div>
      <div class="flow-step">Monitor</div>
    </div>
  </section>

  <section id="scaling">
    <h2>7. Scaling Considerations</h2>
    
    <div class="grid">
      <div class="component">
        <h3>Frontend Scaling</h3>
        <ul>
          <li><strong>Code Splitting</strong>: Lazy loading components</li>
          <li><strong>Asset Optimization</strong>: Compressed resources</li>
          <li><strong>Caching</strong>: Browser and CDN caching</li>
          <li><strong>Web Workers</strong>: Offload heavy processing</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Backend Scaling</h3>
        <ul>
          <li><strong>Serverless</strong>: Auto-scaling functions</li>
          <li><strong>Database Indexing</strong>: Optimized queries</li>
          <li><strong>Rate Limiting</strong>: Prevent abuse</li>
          <li><strong>Caching</strong>: Reduce database load</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Audio Processing Scaling</h3>
        <ul>
          <li><strong>Client-side Processing</strong>: Reduce server load</li>
          <li><strong>Progressive Enhancement</strong>: Adapt to device capabilities</li>
          <li><strong>Chunked Processing</strong>: Handle large files</li>
          <li><strong>Offline Support</strong>: Work without constant connection</li>
        </ul>
      </div>
    </div>
    
    <div class="note">
      <p><strong>Note:</strong> The application primarily uses client-side processing with the Web Audio API, which reduces backend scaling concerns for audio processing. The main scaling considerations are around file storage and database operations.</p>
    </div>
  </section>

  <section id="security">
    <h2>8. Security Considerations</h2>
    
    <div class="grid">
      <div class="component">
        <h3>Authentication Security</h3>
        <ul>
          <li><strong>JWT Tokens</strong>: Secure, short-lived tokens</li>
          <li><strong>HTTPS Only</strong>: Encrypted connections</li>
          <li><strong>CSRF Protection</strong>: Prevent cross-site attacks</li>
          <li><strong>Rate Limiting</strong>: Prevent brute force</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Data Security</h3>
        <ul>
          <li><strong>Access Controls</strong>: Strict permission checks</li>
          <li><strong>Data Validation</strong>: Input sanitization</li>
          <li><strong>Encryption</strong>: Sensitive data protection</li>
          <li><strong>Audit Logging</strong>: Track access and changes</li>
        </ul>
      </div>
      
      <div class="component">
        <h3>Frontend Security</h3>
        <ul>
          <li><strong>CSP</strong>: Content Security Policy</li>
          <li><strong>XSS Prevention</strong>: Escape user content</li>
          <li><strong>Dependency Scanning</strong>: Detect vulnerabilities</li>
          <li><strong>Secure Cookies</strong>: HttpOnly, SameSite</li>
        </ul>
      </div>
    </div>
    
    <div class="warning">
      <p><strong>Security Warning:</strong> Audio files can potentially contain malicious data. Always validate and sanitize uploaded files, and process them in a sandboxed environment when possible.</p>
    </div>
  </section>

  <section id="implementation">
    <h2>9. Implementation Guide</h2>
    
    <h3>Implementation Phases</h3>
    
    <table>
      <tr>
        <th>Phase</th>
        <th>Components</th>
        <th>Timeline</th>
      </tr>
      <tr>
        <td>1. Foundation</td>
        <td>Project setup, Authentication, Basic UI</td>
        <td>2 weeks</td>
      </tr>
      <tr>
        <td>2. Core Features</td>
        <td>Audio Engine, EQ, Compression, Project Management</td>
        <td>4 weeks</td>
      </tr>
      <tr>
        <td>3. Advanced Features</td>
        <td>Presets, Visualization, Export</td>
        <td>3 weeks</td>
      </tr>
      <tr>
        <td>4. Polish & Testing</td>
        <td>UI Refinement, Performance Optimization, Testing</td>
        <td>2 weeks</td>
      </tr>
      <tr>
        <td>5. Deployment</td>
        <td>Production Setup, Monitoring, Documentation</td>
        <td>1 week</td>
      </tr>
    </table>
    
    <h3>Getting Started</h3>
    
    <ol>
      <li><strong>Set up the project</strong>:
        <pre><code>npm create vite@latest master-blaster -- --template react-ts
cd master-blaster
npm install</code></pre>
      </li>
      <li><strong>Add Convex</strong>:
        <pre><code>npm install convex
npx convex init</code></pre>
      </li>
      <li><strong>Add Clerk</strong>:
        <pre><code>npm install @clerk/clerk-react
npm install @clerk/clerk-sdk-node</code></pre>
      </li>
      <li><strong>Configure Authentication</strong>:
        <pre><code>// Create auth.config.ts in convex folder
// Set up ClerkProvider in main.tsx</code></pre>
      </li>
      <li><strong>Implement Core Components</strong>:
        <pre><code>// Create basic UI components
// Set up audio processing engine
// Implement project management</code></pre>
      </li>
    </ol>
    
    <div class="note">
      <p><strong>Note:</strong> This is a high-level implementation guide. Detailed implementation steps would depend on specific requirements and team expertise.</p>
    </div>
  </section>

  <script>
    function showTab(tabId) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deactivate all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show the selected tab content
      document.getElementById(tabId).classList.add('active');
      
      // Activate the clicked tab
      event.currentTarget.classList.add('active');
    }
    
    document.getElementById('runDemo').addEventListener('click', function() {
      const outputDiv = document.getElementById('output');
      outputDiv.innerHTML = '<div class="output">Running MCP demo...</div>';
      
      // Simulate MCP demo
      setTimeout(() => {
        outputDiv.innerHTML += '<div class="output">Initializing MasterBlasterMCP...</div>';
        
        setTimeout(() => {
          outputDiv.innerHTML += '<div class="output">Loading application state...</div>';
          
          setTimeout(() => {
            outputDiv.innerHTML += '<div class="output">Setting up audio processing context...</div>';
            
            setTimeout(() => {
              outputDiv.innerHTML += '<div class="output">MCP ready! Try asking a question about audio processing.</div>';
              
              setTimeout(() => {
                const question = "How can I reduce muddiness in my vocal track?";
                outputDiv.innerHTML += `<div class="output">User question: "${question}"</div>`;
                
                setTimeout(() => {
                  outputDiv.innerHTML += '<div class="output">Generating context for Amazon Q...</div>';
                  
                  setTimeout(() => {
                    outputDiv.innerHTML += `<div class="response">
                      <p><strong>Amazon Q Response:</strong></p>
                      <p>Based on your current EQ settings and the audio analysis, I notice there's some muddiness in the 250-350Hz range. To reduce this, I recommend making the following adjustments to your EQ:</p>
                      <ol>
                        <li>Apply a deeper cut around 300Hz, try -4 to -6dB with a medium Q value (1.0-1.5)</li>
                        <li>You could also try a slight cut around 500Hz to improve clarity</li>
                        <li>Consider boosting slightly at 3-5kHz to bring out vocal presence</li>
                      </ol>
                      <p>Your current -3dB cut at 400Hz is a good start, but you might want to widen the Q value or center it closer to 300Hz where the analysis shows more muddiness.</p>
                    </div>`;
                  }, 1000);
                }, 1000);
              }, 1000);
            }, 800);
          }, 800);
        }, 800);
      }, 500);
    });
  </script>
</body>
</html>